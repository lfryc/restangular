!function(){var a=angular.module("restangular",[]);a.provider("Restangular",function(){var a={};a.init=function(a,b){function c(a,b,c,d){var e={};return _.each(_.keys(d),function(f){var g=d[f];g.params=_.extend({},g.params,a.defaultRequestParams[g.method.toLowerCase()]),_.isEmpty(g.params)&&delete g.params,e[f]=a.isSafe(g.method)?function(){return b(_.extend(g,{url:c}))}:function(a){return b(_.extend(g,{url:c,data:a}))}}),e}var d=["get","head","options","trace"];b.isSafe=function(a){return _.contains(d,a.toLowerCase())},b.baseUrl=_.isUndefined(b.baseUrl)?"":b.baseUrl,a.setBaseUrl=function(a){b.baseUrl="/"===_.last(a)?_.initial(a).join(""):a},b.extraFields=b.extraFields||[],a.setExtraFields=function(a){b.extraFields=a},b.defaultHttpFields=b.defaultHttpFields||{},a.setDefaultHttpFields=function(a){b.defaultHttpFields=a},b.withHttpDefaults=function(a){return _.defaults(a,b.defaultHttpFields)},b.defaultRequestParams=b.defaultRequestParams||{get:{},post:{},put:{},remove:{},common:{}},a.setDefaultRequestParams=function(a){b.defaultRequestParams.common=a},a.requestParams=b.defaultRequestParams,b.defaultHeaders=b.defaultHeaders||{},a.setDefaultHeaders=function(a){b.defaultHeaders=a},b.methodOverriders=b.methodOverriders||[],a.setMethodOverriders=function(a){var c=_.extend([],a);b.isOverridenMethod("delete",c)&&c.push("remove"),b.methodOverriders=c},b.isOverridenMethod=function(a,c){var d=c||b.methodOverriders;return!_.isUndefined(_.find(d,function(b){return b.toLowerCase()===a.toLowerCase()}))},b.urlCreator=b.urlCreator||"path",a.setUrlCreator=function(a){if(!_.has(b.urlCreatorFactory,a))throw new Error("URL Path selected isn't valid");b.urlCreator=a},b.restangularFields=b.restangularFields||{id:"id",route:"route",parentResource:"parentResource",restangularCollection:"restangularCollection",cannonicalId:"__cannonicalId"},a.setRestangularFields=function(a){b.restangularFields=_.extend(b.restangularFields,a)},b.setIdToElem=function(a,c){var d=b.restangularFields.id.split("."),e=a;_.each(_.initial(d),function(a){e[a]={},e=e[a]}),e[_.last(d)]=c},b.getIdFromElem=function(a){var c=b.restangularFields.id.split("."),d=angular.copy(a);return _.each(c,function(a){d=d[a]}),d},b.useCannonicalId=_.isUndefined(b.useCannonicalId)?!1:b.useCannonicalId,a.setUseCannonicalId=function(a){b.useCannonicalId=a},b.responseExtractor=b.responseExtractor||function(a){return a},a.setResponseExtractor=function(a){b.responseExtractor=a},a.setResponseInterceptor=a.setResponseExtractor,b.fullRequestInterceptor=b.fullRequestInterceptor||function(a,b,c,d,e,f){return{element:a,headers:e,params:f}},a.setRequestInterceptor=function(a){b.fullRequestInterceptor=function(b,c,d,e,f,g){return{headers:f,params:g,element:a(b,c,d,e)}}},a.setFullRequestInterceptor=function(a){b.fullRequestInterceptor=a},b.errorInterceptor=b.errorInterceptor||function(){},a.setErrorInterceptor=function(a){b.errorInterceptor=a},b.onBeforeElemRestangularized=b.onBeforeElemRestangularized||function(a){return a},a.setOnBeforeElemRestangularized=function(a){b.onBeforeElemRestangularized=a},b.onElemRestangularized=b.onElemRestangularized||function(a){return a},a.setOnElemRestangularized=function(a){b.onElemRestangularized=a},a.setListTypeIsArray=function(){},b.shouldSaveParent=b.shouldSaveParent||function(){return!0},a.setParentless=function(a){_.isArray(a)?b.shouldSaveParent=function(b){return!_.contains(a,b)}:_.isBoolean(a)&&(b.shouldSaveParent=function(){return!a})},b.suffix=_.isUndefined(b.suffix)?null:b.suffix,a.setRequestSuffix=function(a){b.suffix=a},b.transformers=b.transformers||{},a.addElementTransformer=function(a,c,d){var e=null,f=null;2===arguments.length?f=c:(f=d,e=c);var g=b.transformers[a];g||(g=b.transformers[a]=[]),g.push(function(a,b){return _.isNull(e)||a==e?f(b):b})},a.extendCollection=function(b,c){return a.addElementTransformer(b,!0,c)},a.extendModel=function(b,c){return a.addElementTransformer(b,!1,c)},b.transformElem=function(a,c,d,e){var f=b.transformers[d],g=a;return f&&_.each(f,function(a){g=a(c,g)}),b.onElemRestangularized(g,c,d,e)},b.fullResponse=_.isUndefined(b.fullResponse)?!1:b.fullResponse,a.setFullResponse=function(a){b.fullResponse=a},b.urlCreatorFactory={};var e=function(){};e.prototype.setConfig=function(a){this.config=a},e.prototype.parentsArray=function(a){for(var b=[];a;)b.push(a),a=a[this.config.restangularFields.parentResource];return b.reverse()},e.prototype.resource=function(a,b,d,e,f){var g=_.defaults(e||{},this.config.defaultRequestParams.common),h=_.defaults(d||{},this.config.defaultHeaders),i=this.base(a);return i+=f?"/"+f:"",i+=this.config.suffix||"",c(this.config,b,i,{getList:this.config.withHttpDefaults({method:"GET",params:g,headers:h}),get:this.config.withHttpDefaults({method:"GET",params:g,headers:h}),put:this.config.withHttpDefaults({method:"PUT",params:g,headers:h}),post:this.config.withHttpDefaults({method:"POST",params:g,headers:h}),remove:this.config.withHttpDefaults({method:"DELETE",params:g,headers:h}),head:this.config.withHttpDefaults({method:"HEAD",params:g,headers:h}),trace:this.config.withHttpDefaults({method:"TRACE",params:g,headers:h}),options:this.config.withHttpDefaults({method:"OPTIONS",params:g,headers:h}),patch:this.config.withHttpDefaults({method:"PATCH",params:g,headers:h})})};var f=function(){};f.prototype=new e,f.prototype.base=function(a){var c=this;return this.config.baseUrl+_.reduce(this.parentsArray(a),function(a,d){var e=a+"/"+d[c.config.restangularFields.route];if(!d[c.config.restangularFields.restangularCollection]){var f;f=b.useCannonicalId?d[b.restangularFields.cannonicalId]:c.config.getIdFromElem(d),""===f||_.isUndefined(f)||_.isNull(f)||(e+="/"+f)}return e},"")},f.prototype.fetchUrl=function(a,b){var c=this.base(a);return b&&(c+="/"+b),c},b.urlCreatorFactory.path=f};var b={};a.init(this,b),this.$get=["$http","$q","$timeout",function(c,d,e){function f(g){function h(a,b,c){if(b[g.restangularFields.route]=c,b.getRestangularUrl=_.bind(I.fetchUrl,I,b),b.addRestangularMethod=_.bind(F,b),b.one=_.bind(i,b,b),b.all=_.bind(j,b,b),a&&g.shouldSaveParent(c)){var d=_.union(_.values(_.pick(g.restangularFields,["id","route","parentResource"])),g.extraFields);b[g.restangularFields.parentResource]=_.pick(a,d)}else b[g.restangularFields.parentResource]=null;return b}function i(a,b,c){var d={};return g.setIdToElem(d,c),r(a,d,b)}function j(a,b){return s(a,{},b,!0)}function k(a,b){return a.call=_.bind(l,a),a.get=_.bind(m,a),a[g.restangularFields.restangularCollection]=b,b&&(a.push=_.bind(l,a,"push")),a}function l(a){var b=d.defer(),c=arguments;return this.then(function(d){var e=Array.prototype.slice.call(c,1),f=d[a];f.apply(d,e),b.resolve(d)}),k(b.promise,this[g.restangularFields.restangularCollection])}function m(a){var b=d.defer();return this.then(function(c){b.resolve(c[a])}),k(b.promise,this[g.restangularFields.restangularCollection])}function n(a,b,c){return g.fullResponse?a.resolve(_.extend(b,{data:c})):(a.resolve(c),void 0)}function o(a){return _.omit(a,_.values(_.omit(g.restangularFields,"id")))}function p(a){a.customOperation=_.bind(E,a),_.each(["put","post","get","delete"],function(b){_.each(["do","custom"],function(c){var d="delete"===b?"remove":b,e=c+b.toUpperCase();a[e]=_.bind(E,a,d)})}),a.customGETLIST=_.bind(u,a),a.doGETLIST=a.customGETLIST}function q(a){var b=angular.copy(a);return r(b[g.restangularFields.parentResource],b,b[g.restangularFields.route])}function r(a,b,c){var d=g.onBeforeElemRestangularized(b,!1,c),e=h(a,d,c);return g.useCannonicalId&&(e[g.restangularFields.cannonicalId]=g.getIdFromElem(e)),e[g.restangularFields.restangularCollection]=!1,e.get=_.bind(w,e),e.getList=_.bind(u,e),e.put=_.bind(y,e),e.post=_.bind(z,e),e.remove=_.bind(x,e),e.head=_.bind(A,e),e.trace=_.bind(B,e),e.options=_.bind(C,e),e.patch=_.bind(D,e),p(e),g.transformElem(e,!1,c,H)}function s(a,b,c){var d=g.onBeforeElemRestangularized(b,!0,c),e=h(a,d,c);return e[g.restangularFields.restangularCollection]=!0,e.post=_.bind(z,e,null),e.head=_.bind(A,e),e.trace=_.bind(B,e),e.putElement=_.bind(t,e),e.options=_.bind(C,e),e.patch=_.bind(D,e),e.getList=_.bind(u,e,null),p(e),g.transformElem(e,!0,c,H)}function t(a,b,c){var e=this,f=this[a],g=d.defer();return f.put(b,c).then(function(b){var c=q(e);c[a]=b,g.resolve(c)},function(a){g.reject(a)}),k(g.promise,!0)}function u(a,b,f){var h=this,i=d.defer(),j="getList",l=I.fetchUrl(this,a),m=a||h[g.restangularFields.route],o=g.fullRequestInterceptor(null,j,m,l,f||{},b||{}),p=_.bind(function(b){I.resource(this,c,b.headers,b.params,a).getList().then(function(b){var c=b.data,d=g.responseExtractor(c,j,m,l),e=_.map(d,function(b){return h[g.restangularFields.restangularCollection]?r(h[g.restangularFields.parentResource],b,h[g.restangularFields.route]):r(h,b,a)});e=_.extend(d,e),h[g.restangularFields.restangularCollection]?n(i,b,s(null,e,h[g.restangularFields.route])):n(i,b,s(h,e,a))},function(a){g.errorInterceptor(a),i.reject(a)})},this),q=d.defer();return q.promise.then(p),"promise"in o?o.promise.then(function(a){q.resolve(a)},function(a){q.reject(a)}):e(function(){p(o)}),k(i.promise,!0)}function v(a,b,f,h,i){var j=this,l=d.defer(),m=f||{},p=b||this[g.restangularFields.route],q=I.fetchUrl(this,b),s=h||("remove"===a?void 0:o(this)),t=g.fullRequestInterceptor(s,a,p,q,i||{},m||{}),u=_.bind(function(d){var e=function(c){var d=c.data,e=g.responseExtractor(d,a,p,q);e?"post"!==a||j[g.restangularFields.restangularCollection]?n(l,c,r(j[g.restangularFields.parentResource],e,j[g.restangularFields.route])):n(l,c,r(j,e,b)):n(l,c,void 0)},f=function(a){g.errorInterceptor(a),l.reject(a)},h=a,i=_.extend({},d.headers),k=g.isOverridenMethod(a);k&&(h="post",i=_.extend(i,{"X-HTTP-Method-Override":a})),g.isSafe(a)?k?I.resource(this,c,i,d.params,b)[h]({}).then(e,f):I.resource(this,c,i,d.params,b)[h]().then(e,f):I.resource(this,c,i,d.params,b)[h](d.element).then(e,f)},this),v=d.defer();return v.promise.then(u),"promise"in t?t.promise.then(function(a){v.resolve(a)},function(a){v.reject(a)}):e(function(){u(t)}),k(l.promise)}function w(a,b){return _.bind(v,this)("get",void 0,a,void 0,b)}function x(a,b){return _.bind(v,this)("remove",void 0,a,void 0,b)}function y(a,b){return _.bind(v,this)("put",void 0,a,void 0,b)}function z(a,b,c,d){return _.bind(v,this)("post",a,c,b,d)}function A(a,b){return _.bind(v,this)("head",void 0,a,void 0,b)}function B(a,b){return _.bind(v,this)("trace",void 0,a,void 0,b)}function C(a,b){return _.bind(v,this)("options",void 0,a,void 0,b)}function D(a,b,c){return _.bind(v,this)("patch",void 0,b,a,c)}function E(a,b,c,d,e){return _.bind(v,this)(a,b,c,e,d)}function F(a,b,c,d,e,f){var h;h="getList"===b?_.bind(u,this,c):_.bind(E,this,b,c);var i=function(a,b,c){var g=_.defaults({params:a,headers:b,elem:c},{params:d,headers:e,elem:f});return h(g.params,g.headers,g.elem)};this[a]=g.isSafe(b)?i:function(a,b,c){return i(b,c,a)}}function G(c){var d=angular.copy(b);return a.init(d,d),c(d),f(d)}var H={},I=new g.urlCreatorFactory[g.urlCreator];return I.setConfig(g),a.init(H,g),H.copy=_.bind(q,H),H.withConfig=_.bind(G,H),H.one=_.bind(i,H,null),H.all=_.bind(j,H,null),H.restangularizeElement=_.bind(r,H),H.restangularizeCollection=_.bind(s,H),H}return f(b)}]})}();